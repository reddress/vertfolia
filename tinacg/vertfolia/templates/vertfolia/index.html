{% load staticfiles %}
{% load vertfolia_tags %}

<head>
	<link rel="stylesheet" href="{% static "js/jquery.treeview.css" %}" />
	<link rel="stylesheet" href="{% static "js/screen.css" %}"/>
	<script src="{% static "js/jquery-1.11.0.min.js" %}"></script>
	<script src="{% static "js/jquery.treeview.js" %}"></script>
	<script type="text/javascript">
  $(function () {
	$("#tree").treeview({
	  animated: "fast",
	  control:"#sidetreecontrol",
	  prerendered: true,
	  persist: "location"
	});
  })

  // Handle clicks on tree
  function show_transactions(account_id) {
	alert(account_id);
  }

	</script>
  </head>

Welcome to VertFolia, {{ user.username }}!
<br>
{{ time }}

<div id="account_tree">
{% include "vertfolia/tree.html" %}
</div>

<!-- later: modal window for adding transactions and accounts -->
<!-- add button for "Add expense" that shows expanded expense tree 
 (for clicking -->
 
<form id="add_transaction_form">
  <!-- action="{% url 'add_transaction' %}" method="get"> -->
  {% csrf_token %}
  desc: <input name="description"><br>
  value: <input name="value"><br>
  debit acct num: <input name="debit" value="2"><br>
  credit acct num: <input name="credit" value="6">
  <input type="submit">
</form>

<script>
  var request;
  $("#add_transaction_form").submit(function (event) {
  if (request) {
  request.abort();
  }

  var form = $(this);
  var inputs = form.find("hidden, input, select");
  var serializedData = form.serialize();

  inputs.prop("disabled", true);
  request = $.ajax({
  url: "{% url 'add_transaction' %}",
  type: "post",
  data: serializedData
  });

  request.success(function (response, textStatus, jqXHR) {
	//	alert(response);
  //	$('#account_tree').html(response);
  $.each(response, function (key, val) {
  //	alert(key + val);
  $('#account_balance_'+key).html(val);
  });
  
  });

  request.fail(function (jqXHR, textStatus, errorThrown) {
  alert("ADD TRANSACTION error: " + errorThrown);
  });

  request.always(function () {
  inputs.prop("disabled", false);
  });

  event.preventDefault();
  });
</script>
